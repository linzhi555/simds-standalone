# 分布式集群模拟器单机版

simds-standalone(simulator of distribute cluster - standalone edition)
可用于模拟分布式集群的任务调度，任务运行，任务信息通信等行为。同时支持与集中式集群
对比。

## 使用方法

- 安装 Go >= 1.19 , make
- ``` go get ```  安装依赖
- 根据需要修改config.yaml 内容
- 运行某一个测试
    - 集中式集群测试  ``` make centerTest ```
    - 运行状态共享集群测试 ```make shareTest ```
    - 分布式集群测试 ```make dcssTest ```
- 模拟过程 所有组件的日志信息在 ./components.log
- 模拟 所有任务的提交，开始，介绍 任务日志保存在 ./tasks_event.log
- 分析结果在 ./target/{实验完成时刻}/ 

## 模拟器原理介绍
时间模型: 模拟器使用tick机制更新集群状态。每次tick后模拟时间增加0.1ms。每次tick执行集群所有组件
更新函数,完成集群的一次状态更新。每次更新对集群所有组件的更新是并行的(无锁)，提高模拟效率。

节点模型： 集群每个节点是一个实体，每个实体有一个或多个组件，形象理解为一个节点上可以有多个APP，每个
组件都有象征网络接口的输入和输出管道，组件有多个类型，分别是Scheduler，Taskgen, ResourceManager,StateStorage,
这些组件存储对应功能可能用到的信息。集群中对于每一类组件有两个方法，Setup和Update Setup 用于集群初始化，而
Update则是前面提到的每次tick所调用的更新函数。可以改变注册到每个组件的Setup 和 Update方法实现集群行为的改变。

网络模型： 集群有一个虚拟的实体名称为networker1 ，拥有MockNetworke组件，这个组件与集群其他所有的节点组件网络相连，
即该组件是所有组件输出管道的接受端，所有输入管道的发送端，在一个组件在一个更新函数内发送到另一个节点时，这个
信息塞入管道后，下一次MockNetworke组件执行更新函数时回取出信息，塞入缓存，并检查信息的发送者和接收者决定这个
信息在缓存待多少个tick，模拟网络延迟，之后根据接受者地址塞入对应的接收者管道。如果接收者和发送者同属一个实体，
者不等待直接发送,(本机通信)。

在有上面模型后更改集群实体，组件的组合，以及对应的Update，Setup 定义多种类型的集群。中心化集群为例
共用的任务发生器的更新函数是，在每个tick检查时间，每隔若干个tick，发送任务信息给任务接收节点们（在Setup中初始化)，

中心化调度器更新，每次tick， 从网络接口从得到任务塞入队列，并对任务队列执行若干次调度算法，
（使用设置 SchduerlPerformance修改），得到运行该任务worker的地址,并将运行任务的请求信息发送给对应节点的
ResourceManager组件。

资源管理器组件存在在N个worker中,每个tick更新接收信息，将接收到的任务塞到存储结构中，更改任务信息为start，并
记下开始时间，在若该个tick后任务结束后将任务状态更改为结束。并在结束时告知中心化调度器。

对于分布式集群,每个实体有Scheduler和ResourceManger组件,Scheduler的更新会与其他的同类型Scheduler通信，在本地
资源不足时进行任务分发动作,其具体使用了事件驱动的方式,即对于每种信息都有相应的动作,其具体实现在./cluster_dcss.go
的DcssSchedulerUpdate中，想法是通过统一的事件处理，来实现复杂分发协议。
